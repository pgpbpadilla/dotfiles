#+PROPERTY: header-args:bash :results verbatim

* GnuPG: [[https://www.gnupg.org/][site]]

** Install private GPG keys

   1. Download keys from password manager
   2. Use GPG import:

   #+begin_example bash
   gpg --import path/to/private/key.gpg
   #+end_example


** Enable pinentry in Emacs minibuffer: [[https://emacs.stackexchange.com/a/68304/11978][stackoverflow]]
   :PROPERTIES:
   :CUSTOM_ID: macos-gpg-config
   :END:

   I want to provide GnuPG passphrases directly in the Emacs
   minibuffer, so we need to tell GnuPG which program to use to ask
   for them.
   

*** Backup your current GPG config

    Ensure you're not overwriting useful changes:
    
    #+begin_src bash :dir ~/.gnupg
      tree . | egrep ".conf$"
    #+end_src
   
    #+RESULTS:
    : ├── gpg-agent.conf -> /Users/pgpb.padilla/dotfiles/gpg/macos/gpg-agent.conf
    : ├── gpg.conf -> /Users/pgpb.padilla/dotfiles/gpg/macos/gpg.conf

    
*** Generate [[https://www.gnupg.org/documentation/manuals/gnupg/Agent-Options.html][gpg-agent.conf]] for your processor architecture

    Generate a config file for our system:
    
    #+begin_src bash :dir macos :results output file
      cat <<EOF > gpg-agent.conf
      allow-emacs-pinentry
      pinentry-program $(brew --prefix)/bin/pinentry-mac
      EOF

      echo gpg-agent.conf | tr -d "\n"
    #+end_src

    #+RESULTS:
    [[file:macos/gpg-agent.conf]]

    
**** WARN: Homebrew install path depends on system architecture

     The Homebrew install path changes for different processor
     architectures. To get the correct path use:

     #+begin_src bash
       brew --prefix
     #+end_src

     #+RESULTS:
     : /usr/local
     


*** Install all GnuPG config files

**** MacOS
     
     #+begin_src bash
       ln -svf $(pwd)/macos/*.conf ${HOME}/.gnupg
     #+end_src
   
      #+RESULTS:
      : /Users/pgpb.padilla/.gnupg/gpg-agent.conf -> /Users/pgpb.padilla/dotfiles/gpg/macos/gpg-agent.conf
      : /Users/pgpb.padilla/.gnupg/gpg.conf -> /Users/pgpb.padilla/dotfiles/gpg/macos/gpg.conf
   

**** Linux

     #+begin_src bash
     echo "Intalling config for Linux ..."
     ln -svf $(pwd)/linux/*.conf ${HOME}/.gnupg
     #+end_src


**** Linux: via WSL2: [[https://unix.stackexchange.com/a/655819/55912][stackexchange]]

     *WARN*: The current configuration is only valid for Ubuntu under
     WSL2. 

     #+begin_src bash :results verbatim
       ln -svf $(pwd)/linux/*.conf ${HOME}/.gnupg/
     #+end_src


*** Verify pinentry prompts in minibuffer

    1. restart Emacs
    2. create/open a new encrypted Org file
    3. make some changes
    4. when saving, Emacs should prompt you for the GPG passphrase in
       the minibuffer
    

   

    
